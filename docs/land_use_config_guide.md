# 用地类型配置指南

## 功能概述

用地类型染色功能可以根据地块的位置、面积、周边道路等因素，自动将地块分类为不同的用地类型，并使用不同颜色渲染，模拟真实城市规划。

## UI 控件说明

### 1. 基本开关

在 **样式** 文件夹中：
- **用地类型染色**：主开关，勾选后启用自动染色功能

### 2. 详细配置

在 **样式 → 用地类型配置** 文件夹中，可以对每种用地类型进行细粒度控制：

#### 全局参数
- **随机性** (0-1)：控制分类的随机性程度
  - 0 = 完全确定性，相同条件总是产生相同结果
  - 1 = 高度随机，增加地图多样性

#### 居住用地
- **启用**：是否生成居住用地
- **中心权重** (0-1)：距离地图中心的影响程度
  - 默认 0.3（中等偏好市中心）
- **道路权重** (0-1)：靠近主干道的影响程度
  - 默认 0.2（对道路依赖较低）
- **面积权重** (0-1)：地块面积的影响程度
  - 默认 0.3（中等面积偏好）
- **聚集强度** (0-1)：同类型聚集的倾向
  - 默认 0.5（中等聚集）

#### 商业用地
- **启用**：是否生成商业用地
- **中心权重** (0-1)：默认 0.8（强烈偏好市中心）
- **道路权重** (0-1)：默认 0.5（依赖主干道）
- **面积权重** (0-1)：默认 0.2（对面积要求较低）
- **聚集强度** (0-1)：默认 0.7（强烈聚集形成商业区）

#### 工业用地
- **启用**：是否生成工业用地
- **中心权重** (0-1)：默认 0.1（远离市中心）
- **道路权重** (0-1)：默认 0.3（需要道路但不必是主干道）
- **面积权重** (0-1)：默认 0.5（偏好大面积地块）
- **聚集强度** (0-1)：默认 0.8（强烈聚集形成工业区）

#### 混合用地
- **启用**：是否生成混合用地
- **中心权重** (0-1)：默认 0.5（中性位置）
- **道路权重** (0-1)：默认 0.5（中等道路依赖）
- **面积权重** (0-1)：默认 0.3（中等面积）
- **聚集强度** (0-1)：默认 0.4（较弱聚集）

#### 公共用地
- **启用**：是否生成公共用地
- **中心权重** (0-1)：默认 0.6（偏好市中心）
- **道路权重** (0-1)：默认 0.4（需要可达性）
- **面积权重** (0-1)：默认 0.4（中等面积）
- **聚集强度** (0-1)：默认 0.3（较弱聚集，分散分布）

## 使用场景示例

### 场景1：只生成商业区和住宅区
1. 取消勾选 **工业用地 → 启用**
2. 取消勾选 **混合用地 → 启用**
3. 取消勾选 **公共用地 → 启用**
4. 调整 **商业用地 → 中心权重** 到 1.0，强化市中心商业
5. 调整 **居住用地 → 中心权重** 到 0.1，推向郊区

### 场景2：环形工业带
1. 设置 **工业用地 → 中心权重** 到 0.5
2. 提高 **工业用地 → 聚集强度** 到 1.0
3. 降低 **商业用地 → 中心权重** 到 1.0

### 场景3：高度随机混合城市
1. 提高 **全局参数 → 随机性** 到 0.8
2. 降低所有用地类型的 **聚集强度** 到 0.2
3. 启用所有用地类型

### 场景4：传统同心圆模式
1. **商业用地 → 中心权重** = 1.0
2. **混合用地 → 中心权重** = 0.7
3. **居住用地 → 中心权重** = 0.3
4. **工业用地 → 中心权重** = 0.0
5. 所有聚集强度提高到 0.8+

## 参数调优技巧

### 权重参数的含义
- **中心权重**：控制用地类型与市中心的距离关系
  - 高值 = 偏好市中心
  - 低值 = 偏好郊区
  
- **道路权重**：控制用地类型对主干道的依赖
  - 高值 = 必须靠近主干道
  - 低值 = 可以在次要道路
  
- **面积权重**：控制用地类型对地块面积的偏好
  - 高值 = 偏好大地块
  - 低值 = 偏好小地块

- **聚集强度**：控制同类型用地聚集程度
  - 高值 = 形成大片区域（如工业园区）
  - 低值 = 分散分布（如公园）

### 常见调整策略
1. **强化某种用地类型**：提高其所有权重值
2. **分散某种用地**：降低其聚集强度
3. **推向特定区域**：调整中心权重
4. **依赖交通**：提高道路权重
5. **控制地块规模**：调整面积权重

## 配色方案

当前支持两种配色方案（在 `colour_schemes.json` 中定义）：

### Default 配色
- 居住用地：黄色 (#FFD700)
- 商业用地：红色 (#FF4444)
- 工业用地：紫色 (#9370DB)
- 混合用地：橙色 (#FF8C00)
- 公共用地：绿色 (#32CD32)

### Google Maps 风格
- 居住用地：浅黄 (#F2E8C6)
- 商业用地：浅红 (#FFC7C7)
- 工业用地：浅紫 (#D5C3E0)
- 混合用地：浅橙 (#FFE0B2)
- 公共用地：浅绿 (#B8E6B8)

## 技术说明

### 分类算法
系统使用多因素评分算法：
1. 计算每个地块到市中心的距离
2. 计算到最近主干道的距离
3. 计算地块面积
4. 为每种用地类型计算综合得分
5. 应用聚集算法（相邻地块倾向相同类型）
6. 添加随机扰动
7. 选择得分最高的类型

### 实时更新
- 所有参数调整会立即触发重新分类和重绘
- 大型地图可能需要几秒钟处理时间
- 查看浏览器控制台可以看到分类统计信息

### 性能提示
- 禁用不需要的用地类型可以提高分类速度
- 降低聚集强度可以减少计算量
- 使用较低的随机性值可以获得更一致的结果

## 故障排除

### 问题：调整参数后没有变化
**解决方案**：
1. 确保勾选了 **用地类型染色** 主开关
2. 确保对应的用地类型已 **启用**
3. 点击 **生成建筑** 重新生成地块

### 问题：所有地块都是同一颜色
**可能原因**：
1. 只启用了一种用地类型
2. 某种类型的权重过高，压倒其他类型
3. 聚集强度过高导致单一类型扩散

**解决方案**：
- 启用多种用地类型
- 平衡各类型的权重参数
- 降低聚集强度到 0.5 以下

### 问题：分布不符合预期
**解决方案**：
1. 调整 **中心权重** 控制距离市中心的分布
2. 调整 **道路权重** 控制沿主干道的分布
3. 调整 **聚集强度** 控制区域的连续性
4. 提高 **随机性** 增加多样性

## 开发者信息

相关文件：
- `src/ts/impl/land_use_classifier.ts` - 核心分类算法
- `src/ts/ui/buildings.ts` - 建筑与分类集成
- `src/ts/ui/style.ts` - 渲染实现
- `src/main.ts` - UI 控件
- `src/colour_schemes.json` - 颜色定义

更多技术细节请参考：`docs/land_use_coloring.md`
