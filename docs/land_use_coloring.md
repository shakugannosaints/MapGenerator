# 用地类型自动染色功能

## 功能概述

这个功能实现了基于多种因素的智能用地类型自动分类和可视化染色系统。它能够根据地块的位置、大小、到道路的距离等因素，自动将建筑地块分类为不同的用地类型，并使用不同的颜色进行渲染，类似于城市规划图。

## 用地类型

系统支持以下五种用地类型：

1. **住宅 (Residential)** - 淡黄色
   - 主要分布在中间区域
   - 小到中等大小的地块

2. **商业 (Commercial)** - 淡红色
   - 主要分布在市中心
   - 靠近主干道
   - 中等大小的地块

3. **工业 (Industrial)** - 淡紫色
   - 主要分布在城市外围
   - 大型地块
   - 远离市中心

4. **混合用地 (Mixed Use)** - 橙色
   - 分布在商业和住宅的过渡区域
   - 靠近主要道路
   - 中等大小的地块

5. **公共设施 (Public)** - 淡绿色
   - 靠近主干道
   - 较大的地块
   - 分布较为分散

## 分类算法

系统使用智能的多因素评分算法来确定每个地块的用地类型：

### 主要影响因素

1. **距离中心的距离 (权重: 0.4)**
   - 中心区域 (< 30% 半径): 偏向商业和混合用地
   - 中间区域 (30%-70% 半径): 偏向住宅
   - 外围区域 (> 70% 半径): 偏向工业

2. **到主干道的距离 (权重: 0.3)**
   - 靠近主干道 (< 50m): 偏向商业和公共设施
   - 靠近主要道路 (< 30m): 偏向混合用地
   - 远离主要道路: 偏向住宅

3. **地块面积 (权重: 0.2)**
   - 大地块 (> 70% 参考面积): 偏向工业和公共设施
   - 中等地块 (30%-70% 参考面积): 偏向住宅和混合用地
   - 小地块 (< 30% 参考面积): 偏向住宅和商业

4. **聚类效应 (强度: 0.5)**
   - 相邻地块倾向于具有相同的用地类型
   - 通过迭代算法实现区域聚类
   - 模拟真实城市中用地类型的聚集效应

5. **随机性 (因子: 0.2)**
   - 添加适度的随机性增加多样性
   - 避免过于规则的模式

## 使用方法

### 启用功能

1. 在右侧的GUI面板中找到 **"样式"** 文件夹
2. 勾选 **"用地类型染色"** 选项
3. 生成建筑后，地块将自动按照用地类型进行染色

### 最佳实践

1. **先生成道路**: 确保已经生成主干道和主要道路，因为分类算法依赖道路数据
2. **调整密度**: 可以使用"建筑密度"参数来控制显示的建筑数量
3. **配合3D模式**: 开启"建筑模型"选项可以在3D视图中查看用地类型染色效果
4. **尝试不同配色**: 不同的配色方案有不同的用地颜色定义

### 自定义颜色

可以在 `src/colour_schemes.json` 中为不同的配色方案自定义用地类型颜色：

```json
"landUseColors": {
    "residential": "rgb(255, 250, 205)",
    "commercial": "rgb(255, 200, 200)",
    "industrial": "rgb(210, 210, 240)",
    "mixed_use": "rgb(255, 230, 200)",
    "public": "rgb(200, 240, 200)"
}
```

## 技术实现

### 核心组件

1. **LandUseClassifier** (`src/ts/impl/land_use_classifier.ts`)
   - 实现分类算法
   - 计算各种影响因素
   - 应用聚类效应

2. **Buildings** (`src/ts/ui/buildings.ts`)
   - 集成分类器
   - 管理用地信息
   - 提供UI控制

3. **Style** (`src/ts/ui/style.ts`)
   - 渲染不同颜色的地块
   - 支持2D和3D视图

### 扩展性

系统设计具有良好的扩展性：

- 可以轻松添加新的用地类型
- 可以调整分类算法的权重和参数
- 可以为不同配色方案定义不同的用地颜色
- 可以通过 `LandUseConfig` 接口自定义分类器行为

## 示例场景

### 典型的城市布局

启用用地染色后，你会看到：

- **市中心**: 主要是红色（商业）和橙色（混合用地）
- **中间环带**: 主要是黄色（住宅）
- **外围区域**: 紫色（工业）和黄色（住宅）的混合
- **主干道附近**: 商业和公共设施的集中
- **聚类区域**: 相同颜色的地块会形成连片区域

## 注意事项

1. 分类结果具有随机性，每次生成可能略有不同
2. 需要先生成建筑才能看到染色效果
3. 建议在较大的缩放级别（zoom）下查看效果
4. 如果禁用染色，将恢复到默认的单一建筑颜色

## 未来改进方向

- 添加更多用地类型（如绿地、文教等）
- 支持用户手动调整分类参数
- 实现基于地形的分类影响
- 添加统计信息显示各类用地的占比
- 支持导出用地规划数据
